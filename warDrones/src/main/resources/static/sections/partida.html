<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partida</title>
    <link rel="stylesheet" href="../css/fondo.css">
    <link rel="stylesheet" href="../css/botom.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jacquard+12&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/fuente.css">
</head>
<body style="margin: 0; min-height: 100vh; display: flex; align-items: stretch;">
    <aside style="width: 25vw; min-width: 260px; max-width: 380px; position: relative; display: flex; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box;">
        <img src="../img/gold_panel_8x.png" alt="Panel" style="position: absolute; inset: 16px; width: calc(100% - 32px); height: calc(100% - 32px); image-rendering: pixelated;">
        <div style="position: relative; z-index: 1; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 12px;">
            <h1 class="jacquard-12-regular" style="margin: 0 0 6px; font-size: 46px; text-align: center;">Partida</h1>
            <p class="jacquard-12-regular" style="margin: 0; font-size: 24px;">Mapa 2D</p>
            <form action="menu.html" method="get">
                <button class="boton boton-menu" type="submit" style="font-size: 18px;"><span class="jacquard-12-regular">Volver al Menu</span></button>
            </form>
            <section style="width: 100%; max-width: 280px; background: rgba(19, 31, 38, 0.75); border: 2px solid #f2cb67; padding: 10px; box-sizing: border-box; color: #f7e7b2;">
                <p id="bandoLabel" class="jacquard-12-regular" style="margin: 0 0 4px; font-size: 24px;">Bando: -</p>
                <p id="droneTypeLabel" class="jacquard-12-regular" style="margin: 0 0 2px; font-size: 22px;">Dron activo: -</p>
                <p id="droneRangeLabel" class="jacquard-12-regular" style="margin: 0 0 2px; font-size: 20px;">Alcance: -</p>
                <p id="droneVisionLabel" class="jacquard-12-regular" style="margin: 0 0 6px; font-size: 20px;">Vision: -</p>
                <p id="setupHint" class="jacquard-12-regular" style="margin: 0 0 6px; font-size: 16px;">Inicio sin piezas. Elige un dron y pulsa Desplegar.</p>
                <button id="deployDroneBtn" class="boton" type="button" style="font-size: 16px; width: 100%; height: 34px; margin-bottom: 8px;">
                    <span class="jacquard-12-regular">Desplegar Dron</span>
                </button>
                <button id="nextDroneBtn" class="boton" type="button" style="font-size: 16px; width: 100%; height: 34px; margin-bottom: 8px;">
                    <span class="jacquard-12-regular">Cambiar Dron</span>
                </button>
                <div id="fleetList" style="max-height: 240px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px;"></div>
            </section>
        </div>
    </aside>

    <main style="width: 75vw; padding: 16px 16px 16px 0; box-sizing: border-box; display: flex; align-items: stretch;">
        <canvas id="mapCanvas" style="width: 100%; height: calc(100vh - 32px); border: 4px solid #6a4a1c; box-sizing: border-box; background: #24323d; cursor: pointer;"></canvas>
    </main>

<script src="../js/partida.js"></script>
<script>
        // Este string puede venir de URL, BD, session, etc.
    // Si otro modulo ya define un valor, usa window.BANDO_ENTRADA.
    const bandoEntradaRaw = window.BANDO_ENTRADA ?? new URLSearchParams(window.location.search).get('bando') ?? 'aereo';
    const partidaApp = new PartidaApp(bandoEntradaRaw);

    // Funciones comunes
    partidaApp.cargarSpritePortaNaval();
    partidaApp.cargarSpritePortaAereo();
    partidaApp.ajustarCanvasBase();
    partidaApp.reiniciarNiebla();
    partidaApp.posicionarPortaNaval();
    partidaApp.posicionarPortaAereo();
    partidaApp.crearFlotaSegunBando();

    if (partidaApp.esNaval()) {
        partidaApp.cargarSpriteDronNaval();
        partidaApp.revelarInicioNaval();
        partidaApp.menuNaval();
        partidaApp.desplegarDronesNaval();
    } else {
        partidaApp.cargarSpriteDronAereo();
        partidaApp.revelarInicioAereo();
        partidaApp.menuAereo();
        partidaApp.desplegarDronesAereo();
    }

    partidaApp.aplicarVisionActiva();
    partidaApp.renderizarEscena();
    partidaApp.iniciarLoop();
</script>
</body>
</html>




